# NDArray API Reference

## Overview

`NDArray` is a multi-dimensional array implementation providing NumPy-like functionality for Dart. It supports efficient storage, computation, and manipulation of numerical data.

## Constructor

### NDArray(dynamic data, {DType? dtype})

Creates an NDArray from nested lists or flat data.

```dart
// From nested lists
final array = NDArray([[1, 2, 3], [4, 5, 6]]);

// With explicit dtype
final floatArray = NDArray([1, 2, 3], dtype: DType.float64);

// 3D array
final cube = NDArray([[[1, 2], [3, 4]], [[5, 6], [7, 8]]]);
```

## Factory Constructors

### NDArray.zeros(List<int> shape, {DType dtype = DType.float64})

Creates an array filled with zeros.

```dart
final zeros = NDArray.zeros([3, 4]); // 3x4 array of zeros
```

### NDArray.ones(List<int> shape, {DType dtype = DType.float64})

Creates an array filled with ones.

```dart
final ones = NDArray.ones([2, 3]); // 2x3 array of ones
```

### NDArray.full(List<int> shape, dynamic value, {DType? dtype})

Creates an array filled with a specific value.

```dart
final fives = NDArray.full([3, 3], 5); // 3x3 array of 5s
```

### NDArray.generate(List<int> shape, dynamic Function(List<int>) generator)

Creates an array with values generated by a function.

```dart
// Generate a range [0, 2, 4, 6, 8]
final range = NDArray.generate([5], (indices) => indices[0] * 2);

// Generate a 2D array
final matrix = NDArray.generate([3, 3], (indices) => indices[0] * 3 + indices[1]);
// Result: [[0, 1, 2], [3, 4, 5], [6, 7, 8]]
```

## Properties

### shape → Shape

Returns the shape of the array.

```dart
final array = NDArray([[1, 2, 3], [4, 5, 6]]);
print(array.shape); // Shape([2, 3])
```

### ndim → int

Returns the number of dimensions.

```dart
final array = NDArray([[[1, 2], [3, 4]]]);
print(array.ndim); // 3
```

### size → int

Returns the total number of elements.

```dart
final array = NDArray([[1, 2], [3, 4]]);
print(array.size); // 4
```

### dtype → DType

Returns the data type of the array.

```dart
final array = NDArray([1.0, 2.0, 3.0]);
print(array.dtype); // DType.float64
```

## Indexing & Slicing

### getValue(List<int> indices) → dynamic

Gets a single value at the specified indices.

```dart
final array = NDArray([[1, 2, 3], [4, 5, 6]]);
print(array.getValue([0, 1])); // 2
```

### setValue(List<int> indices, dynamic value)

Sets a single value at the specified indices.

```dart
final array = NDArray([[1, 2], [3, 4]]);
array.setValue([0, 1], 10);
// array is now [[1, 10], [3, 4]]
```

### slice(List<SliceRange> ranges) → NDArray

Extracts a sub-array using slice ranges.

```dart
final array = NDArray([[1, 2, 3], [4, 5, 6], [7, 8, 9]]);
final sliced = array.slice([
  SliceRange(0, 2),  // rows 0-1
  SliceRange(1, 3),  // columns 1-2
]);
// Result: [[2, 3], [5, 6]]
```

## Arithmetic Operations

### operator +(dynamic other) → NDArray

Element-wise addition.

```dart
final a = NDArray([1, 2, 3]);
final b = NDArray([4, 5, 6]);
final sum = a + b; // [5, 7, 9]

// Scalar addition
final c = a + 10; // [11, 12, 13]
```

### operator -(dynamic other) → NDArray

Element-wise subtraction.

```dart
final a = NDArray([5, 6, 7]);
final b = NDArray([1, 2, 3]);
final diff = a - b; // [4, 4, 4]
```

### operator *(dynamic other) → NDArray

Element-wise multiplication.

```dart
final a = NDArray([1, 2, 3]);
final b = NDArray([2, 3, 4]);
final product = a * b; // [2, 6, 12]
```

### operator /(dynamic other) → NDArray

Element-wise division.

```dart
final a = NDArray([10, 20, 30]);
final b = NDArray([2, 4, 5]);
final quotient = a / b; // [5, 5, 6]
```

## Mathematical Functions

### sum({int? axis}) → dynamic

Computes the sum of array elements.

```dart
final array = NDArray([[1, 2], [3, 4]]);
print(array.sum()); // 10

// Sum along axis
final rowSums = array.sum(axis: 0); // [4, 6]
```

### mean({int? axis}) → dynamic

Computes the mean of array elements.

```dart
final array = NDArray([1, 2, 3, 4, 5]);
print(array.mean()); // 3.0
```

### min({int? axis}) → dynamic

Finds the minimum value.

```dart
final array = NDArray([[1, 5], [2, 3]]);
print(array.min()); // 1
```

### max({int? axis}) → dynamic

Finds the maximum value.

```dart
final array = NDArray([[1, 5], [2, 3]]);
print(array.max()); // 5
```

### std({int? axis}) → dynamic

Computes the standard deviation.

```dart
final array = NDArray([1, 2, 3, 4, 5]);
print(array.std()); // ~1.414
```

## Filtering & Selection

### where(bool Function(dynamic) condition) → NDArray

Filters elements based on a condition.

```dart
final array = NDArray([1, 2, 3, 4, 5]);
final filtered = array.where((x) => x > 2);
// Result: [3, 4, 5]
```

### whereIndices(bool Function(dynamic) condition) → List<List<int>>

Returns indices where condition is true.

```dart
final array = NDArray([[1, 2], [3, 4]]);
final indices = array.whereIndices((x) => x > 2);
// Result: [[1, 0], [1, 1]]
```

### select(List<List<int>> indices) → NDArray

Selects elements at specified indices.

```dart
final array = NDArray([[1, 2], [3, 4]]);
final selected = array.select([[0, 0], [1, 1]]);
// Result: [1, 4]
```

### mask(NDArray boolMask) → NDArray

Filters using a boolean mask.

```dart
final array = NDArray([1, 2, 3, 4, 5]);
final mask = NDArray([true, false, true, false, true]);
final masked = array.mask(mask);
// Result: [1, 3, 5]
```

## Reshaping

### reshape(List<int> newShape) → NDArray

Returns a new array with the specified shape.

```dart
final array = NDArray([1, 2, 3, 4, 5, 6]);
final reshaped = array.reshape([2, 3]);
// Result: [[1, 2, 3], [4, 5, 6]]
```

### flatten() → NDArray

Returns a flattened 1D array.

```dart
final array = NDArray([[1, 2], [3, 4]]);
final flat = array.flatten();
// Result: [1, 2, 3, 4]
```

### transpose({List<int>? axes}) → NDArray

Transposes the array.

```dart
final array = NDArray([[1, 2, 3], [4, 5, 6]]);
final transposed = array.transpose();
// Result: [[1, 4], [2, 5], [3, 6]]
```

## Broadcasting

NDArray supports NumPy-style broadcasting for operations between arrays of different shapes.

```dart
final a = NDArray([[1, 2, 3]]);  // Shape: [1, 3]
final b = NDArray([[1], [2], [3]]);  // Shape: [3, 1]
final result = a + b;
// Result: [[2, 3, 4], [3, 4, 5], [4, 5, 6]]
```

## Type Conversion

### asType(DType newDtype) → NDArray

Converts array to a different data type.

```dart
final intArray = NDArray([1, 2, 3]);
final floatArray = intArray.asType(DType.float64);
```

### toList() → List<dynamic>

Converts array to nested Dart lists.

```dart
final array = NDArray([[1, 2], [3, 4]]);
final list = array.toList();
// Result: [[1, 2], [3, 4]]
```

## See Also

- [DataCube API](datacube.md)
- [Storage API](storage.md)
- [NDArray Basics Guide](../guides/ndarray_basics.md)
